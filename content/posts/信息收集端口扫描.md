---
title: 信息收集与扫描


---

# 信息收集与扫描

信息收集是指攻击者多攻击目标进行有计划和有步骤的信息收集从而了解目标的网络环境和信息安全状况的过程。

+ 攻击目标网络 域名、IP地址、DNS服务器、邮件服务器、网络拓扑结构
+ 攻击目标的个人 身份信息、职业等

收集方法

+ 注册机构Whois查询
+ DNS和IP收集
+ WEB信息检索
+ 网络拓扑侦察

常用工具：

+ https://whois.aliyun.com/（万网）
+ https://whois.chinaz.com/
+ dig     host    fierce    nslookup
+ shodan

<img src="https://gitee.com/lsyzc/picture/raw/master/picture/image-20211007162952101.png" alt="image-20211007162952101"  />

<img src="https://gitee.com/lsyzc/picture/raw/master/picture/image-20211007163107293.png" alt="image-20211007163107293"  />

<img src="https://gitee.com/lsyzc/picture/raw/master/picture/image-20211007163158757.png" alt="image-20211007163158757"  />


## 主机发现

-sL(列表扫描)

-sP(Ping扫描)

-Pn(无ping)

-PS(TCP SYN Ping)

-PU(UDP Ping)

-PR(ARP Ping)

-n(不用域名解析)

-R(为所有目标解析域名)

```shell
nmap -sP -n -v 192.169.6.0/24
```




## 端口扫描

+ Nmap漏洞扫描

  四种最基本的扫描：

  + TCP connect(-sT参数)

  + TCP SYN(-sS参数)

  + UDP(-sU参数)

  + Ping(-sP参数)

  端口的几种状态：open(开放的)， closed(关闭的)，和filtered(被过滤的) 状态

  ```shell
  -sS (TCP SYN扫描)
  SYN扫描作为默认的也是最受欢迎的扫描选项，是有充分理由的。 它执行得很快，在一个没有入侵防火墙的快速网络上，每秒钟可以扫描数千个 端口。 SYN扫描相对来说不张扬，不易被注意到，因为它从来不完成TCP连接。 它也不像Fin/Null/Xmas，Maimon和Idle扫描依赖于特定平台，而可以应对任何兼容的 TCP协议栈。 它还可以明确可靠地区分open(开放的)， closed(关闭的)，和filtered(被过滤的) 状态
  
  它常常被称为半开放扫描， 因为它不打开一个完全的TCP连接。它发送一个SYN报文， 就像您真的要打开一个连接，然后等待响应。 SYN/ACK表示端口在监听 (开放)，而 RST (复位)表示没有监听者。如果数次重发后仍没响应， 该端口就被标记为被过滤。如果收到ICMP不可到达错误 (类型3，代码1，2，3，9，10，或者13)，该端口也被标记为被过滤。
  
  -sT (TCP connect()扫描)
  当SYN扫描不能用时，CP Connect()扫描就是默认的TCP扫描。 当用户没有权限发送原始报文或者扫描IPv6网络时，就是这种情况。 Instead of writing raw packets as most other scan types do，Nmap通过创建connect() 系统调用要求操作系统和目标机以及端口建立连接，而不像其它扫描类型直接发送原始报文。 这是和Web浏览器，P2P客户端以及大多数其它网络应用程序用以建立连接一样的 高层系统调用。它是叫做Berkeley Sockets API编程接口的一部分。Nmap用 该API获得每个连接尝试的状态信息，而不是读取响应的原始报文。
  
  当SYN扫描可用时，它通常是更好的选择。因为Nmap对高层的 connect()调用比对原始报文控制更少， 所以前者效率较低。 该系统调用完全连接到开放的目标端口而不是像SYN扫描进行 半开放的复位。这不仅花更长时间，需要更多报文得到同样信息，目标机也更可能 记录下连接。IDS(入侵检测系统)可以捕获两者，但大部分机器没有这样的警报系统。 当Nmap连接，然后不发送数据又关闭连接， 许多普通UNIX系统上的服务会在syslog留下记录，有时候是一条加密的错误消息。 此时，有些真正可怜的服务会崩溃，虽然这不常发生。如果管理员在日志里看到来自同一系统的 一堆连接尝试，她应该知道她的系统被扫描了。
  
  -sU (UDP扫描)
  虽然互联网上很多流行的服务运行在TCP 协议上，UDP服务也不少。 DNS，SNMP，和DHCP (注册的端口是53，161/162，和67/68)是最常见的三个。 因为UDP扫描一般较慢，比TCP更困难，一些安全审核人员忽略这些端口。 这是一个错误，因为可探测的UDP服务相当普遍，攻击者当然不会忽略整个协议。 所幸，Nmap可以帮助记录并报告UDP端口。
  
  UDP扫描用-sU选项激活。它可以和TCP扫描如 SYN扫描 (-sS)结合使用来同时检查两种协议。
  
  UDP扫描发送空的(没有数据)UDP报头到每个目标端口。 如果返回ICMP端口不可到达错误(类型3，代码3)， 该端口是closed(关闭的)。 其它ICMP不可到达错误(类型3， 代码1，2，9，10，或者13)表明该端口是filtered(被过滤的)。 偶尔地，某服务会响应一个UDP报文，证明该端口是open(开放的)。 如果几次重试后还没有响应，该端口就被认为是 open|filtered(开放|被过滤的)。 这意味着该端口可能是开放的，也可能包过滤器正在封锁通信。 可以用版本扫描(-sV)帮助区分真正的开放端口和被过滤的端口。
  
  UDP扫描的巨大挑战是怎样使它更快速。 开放的和被过滤的端口很少响应，让Nmap超时然后再探测，以防探测帧或者 响应丢失。关闭的端口常常是更大的问题。 它们一般发回一个ICMP端口无法到达错误。但是不像关闭的TCP端口响应SYN或者Connect 扫描所发送的RST报文，许多主机在默认情况下限制ICMP端口不可到达消息。 Linux和Solaris对此特别严格。例如， Linux 2.4.20内核限制一秒钟只发送一条目标不可到达消息 (见net/ipv4/icmp。c)。
  
  ```

  秘密扫描：

    + FIN扫描 -sF
    + ACK扫描 -sA
    + NULL扫描 -sN
    + XMAS扫描 -sX

  ![image-20211007150502630](https://gitee.com/lsyzc/picture/raw/master/picture/image-20211007150502630.png)

  ```shell
  -sA (TCP ACK扫描)
  这种扫描与目前为止讨论的其它扫描的不同之处在于 它不能确定open(开放的)或者 open|filtered(开放或者过滤的))端口。 它用于发现防火墙规则，确定它们是有状态的还是无状态的，哪些端口是被过滤的。
  
  ACK扫描探测报文只设置ACK标志位(除非您使用 --scanflags)。当扫描未被过滤的系统时， open(开放的)和closed(关闭的) 端口 都会返回RST报文。Nmap把它们标记为 unfiltered(未被过滤的)，意思是 ACK报文不能到达，但至于它们是open(开放的)或者 closed(关闭的) 无法确定。不响应的端口 或者发送特定的ICMP错误消息(类型3，代号1，2，3，9，10， 或者13)的端口，标记为 filtered(被过滤的)。
  -sN; -sF; -sX (TCP Null，FIN，and Xmas扫描)
  这三种扫描类型 (甚至用下一节描述的 --scanflags 选项的更多类型) 在TCP RFC 中发掘了一个微妙的方法来区分open(开放的)和 closed(关闭的)端口。第65页说“如果 [目标]端口状态是关闭的.... 进入的不含RST的报文导致一个RST响应。” 接下来的一页 讨论不设置SYN，RST，或者ACK位的报文发送到开放端口: “理论上，这不应该发生，如果您确实收到了，丢弃该报文，返回。 ”
  
  如果扫描系统遵循该RFC，当端口关闭时，任何不包含SYN，RST，或者ACK位的报文会导致 一个RST返回，而当端口开放时，应该没有任何响应。只要不包含SYN，RST，或者ACK， 任何其它三种(FIN，PSH，and URG)的组合都行。Nmap有三种扫描类型利用这一点：
  
  Null扫描 (-sN)
  不设置任何标志位(tcp标志头是0)
  
  FIN扫描 (-sF)
  只设置TCP FIN标志位。
  
  Xmas扫描 (-sX)
  设置FIN，PSH，和URG标志位，就像点亮圣诞树上所有的灯一样。
  
  除了探测报文的标志位不同，这三种扫描在行为上完全一致。 如果收到一个RST报文，该端口被认为是 closed(关闭的)，而没有响应则意味着 端口是open|filtered(开放或者被过滤的)。 如果收到ICMP不可到达错误(类型 3，代号 1，2，3，9，10，或者13)，该端口就被标记为 被过滤的。
  
  这些扫描的关键优势是它们能躲过一些无状态防火墙和报文过滤路由器。 另一个优势是这些扫描类型甚至比SYN扫描还要隐秘一些。但是别依赖它 -- 多数 现代的IDS产品可以发现它们。一个很大的不足是并非所有系统都严格遵循RFC 793。 许多系统不管端口开放还是关闭，都响应RST。 这导致所有端口都标记为closed(关闭的)。 这样的操作系统主要有Microsoft Windows，许多Cisco设备，BSDI，以及IBM OS/400。 但是这种扫描对多数UNIX系统都能工作。这些扫描的另一个不足是 它们不能辨别open(开放的)端口和一些特定的 filtered(被过滤的)端口，从而返回 open|filtered(开放或者被过滤的)。
  ```
## 服务版本检测&&脚本扫描&&OS检测

nmap -v -SV 192.168.7.2 服务版本检测

nmap -v -O 192.168.7.2  OS检测

namp --script

![image-20211007161016825](C:/Users/Lsy/AppData/Roaming/Typora/typora-user-images/image-20211007161016825.png)



